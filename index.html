<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Rica Chicha - ASWA </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'aswa-pedidos';

        window.db = db;
        window.appId = appId;
        window.isAuth = false;

        const initAuth = async () => {
          if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token).catch(() => signInAnonymously(auth));
          } else {
            await signInAnonymously(auth);
          }
        };
        initAuth();

        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.isAuth = true;
            }
        });
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0a0a0b;
            color: white;
            -webkit-tap-highlight-color: transparent;
        }
        .font-bebas { font-family: 'Bebas Neue', cursive; }
        
        .logo-container {
            width: 70px;
            height: 70px;
            background: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.3);
            border: 2px solid #facc15;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            display: block;
        }

        /* Estilo para el QR de pago */
        .qr-image {
            width: 180px;
            height: 180px;
            object-fit: contain;
            border-radius: 1rem;
            border: 4px solid #fff;
        }

        .img-placeholder {
            display: none;
            font-size: 1.875rem;
            line-height: 1;
        }
        .product-img-wrapper {
            width: 80px;
            height: 80px;
            border-radius: 18px;
            border: 1px solid #333;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .product-img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            z-index: 10;
        }

        .img-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #facc15;
            font-weight: 800;
            font-size: 1.2rem;
            text-align: center;
            line-height: 1;
        }

        .app-card {
            background: linear-gradient(145deg, #18181b, #0f0f11);
            border: 1px solid #27272a;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .app-card:active { transform: scale(0.97); }

        .input-dark {
            background-color: #121214;
            border: 1px solid #27272a;
            color: white;
            transition: border-color 0.3s;
        }

        .input-dark:focus { border-color: #facc15; outline: none; }
        
        .btn-order {
            background: linear-gradient(to right, #facc15, #eab308);
            box-shadow: 0 10px 30px rgba(234, 179, 8, 0.3);
            color: #000;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .payment-option {
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .payment-option.active {
            border-color: #facc15;
            background: rgba(250, 204, 21, 0.1);
        }
        .social-badge {
            padding: 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        .social-badge:active { transform: scale(0.9); }
        .bg-fb { background: #1877F2; }
        .bg-ig { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }

        #successMsg {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 2000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body class="min-h-screen pb-48">

    <!-- MENSAJE DE √âXITO -->
    <div id="successMsg">
        <div class="w-24 h-24 bg-yellow-500 rounded-full flex items-center justify-center mb-6 animate-bounce">
            <i data-lucide="check" class="text-black w-14 h-14"></i>
        </div>
        <h2 class="text-4xl font-bebas text-yellow-400 mb-2 tracking-widest">¬°PEDIDO EN CAMINO!</h2>
        <p class="text-zinc-400 mb-8 font-bold">Estamos abriendo WhatsApp para procesar tu entrega...</p>
    </div>

    <!-- PANEL DE ADMINISTRACI√ìN -->
    <div id="adminPanel" class="fixed inset-0 bg-black z-[1000] hidden overflow-y-auto p-6">
        <div class="flex justify-between items-center mb-8 border-b border-zinc-800 pb-4">
            <h2 class="font-bebas text-4xl text-yellow-500 tracking-tighter">LISTA DE PEDIDOS</h2>
            <button onclick="cerrarAdmin()" class="bg-zinc-800 p-2 rounded-full"><i data-lucide="x"></i></button>
        </div>
        <div id="listaPedidos" class="space-y-4 pb-20"></div>
    </div>

    <!-- NAVEGACI√ìN -->
    <nav class="fixed top-0 left-0 w-full bg-black/80 backdrop-blur-md z-50 border-b border-zinc-900 px-6 py-4">
        <div class="max-w-md mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="logo-container" onclick="checkAdmin()">
                    <!-- Intenta cargar el logo local, si falla muestra un icono de Ma√≠z dorado -->
                   <img src="logo de aswa.jpg" alt="Logo ASWA" onerror="this.style.display='none'; document.getElementById('placeholder').style.display='block';">
                    <div id="placeholder" class="img-placeholder"></div>
                </div>
                <div>
                    <h1 class="font-bebas text-3xl text-yellow-400 leading-none tracking-widest">ASWA</h1>
                    <p class="text-[8px] text-zinc-500 font-bold uppercase tracking-[0.4em] mt-1">La Rica Chicha</p>
                </div>
            </div>
            <div class="flex gap-2">
                <a href="https://www.facebook.com/profile.php?id=100052222886761" target="_blank" class="social-badge bg-fb">
                    <i data-lucide="facebook" class="w-5 h-5 text-white"></i>
                </a>
                <a href="https://www.instagram.com/aswa.laricachicha/" target="_blank" class="social-badge bg-ig">
                    <i data-lucide="instagram" class="w-5 h-5 text-white"></i>
                </a>
            </div>
        </div>
    </nav>

    <div class="h-32"></div>

    <form id="orderForm" onsubmit="generarPedido(event)" class="max-w-md mx-auto px-6 space-y-8">
        
        <!-- PRODUCTOS -->
        <section>
            <div class="flex items-center justify-between mb-5">
                <h2 class="font-bold text-lg flex items-center gap-2">
                    <span class="w-1.5 h-6 bg-yellow-500 rounded-full"></span>
                    Selecciona tu pack
                </h2>
                <span class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">3 Opciones</span>
            </div>

            <div class="space-y-3">
                <!-- 2L -->
                <div class="app-card rounded-[2rem] p-4 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="product-img-wrapper">
                            <img src="aswa de 2 litros 1.png" alt="Chicha ASWA 2L" onerror="this.style.display='none'">
                            <div class="img-placeholder">
                                <span class="text-xs">ASWA</span>
                                <span class="text-xl">2L</span>
                            </div>
                        </div>
                        <div>
                            <p class="font-bold text-sm">Presentaci√≥n 2L</p>
                            <p class="text-yellow-400 font-black text-xl">S/ 9.00</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 bg-black p-2 rounded-2xl border border-zinc-800">
                        <button type="button" onclick="updateQty('p2l', -1)" class="w-8 h-8 font-black text-zinc-600">-</button>
                        <span id="qty-p2l" class="font-bold text-lg w-4 text-center">0</span>
                        <button type="button" onclick="updateQty('p2l', 1)" class="w-8 h-8 bg-yellow-500 text-black rounded-xl font-black shadow-lg shadow-yellow-500/20">+</button>
                    </div>
                </div>

                <!-- 3L -->
                <div class="app-card rounded-[2rem] p-4 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="product-img-wrapper">
                            <img src="aswa de 3 litros.png" alt="Chicha ASWA 3L" onerror="this.style.display='none'">
                            <div class="img-placeholder">
                                <span class="text-xs">ASWA</span>
                                <span class="text-xl">3L</span>
                            </div>
                        </div>
                        <div>
                            <p class="font-bold text-sm">Presentaci√≥n 3L</p>
                            <p class="text-yellow-400 font-black text-xl">S/ 13.00</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 bg-black p-2 rounded-2xl border border-zinc-800">
                        <button type="button" onclick="updateQty('p3l', -1)" class="w-8 h-8 font-black text-zinc-600">-</button>
                        <span id="qty-p3l" class="font-bold text-lg w-4 text-center">0</span>
                        <button type="button" onclick="updateQty('p3l', 1)" class="w-8 h-8 bg-yellow-500 text-black rounded-xl font-black shadow-lg shadow-yellow-500/20">+</button>
                    </div>
                </div>

                <!-- 4L -->
                <div class="app-card rounded-[2rem] p-4 flex items-center justify-between border border-yellow-500/30">
                    <div class="flex items-center gap-4">
                        <div class="product-img-wrapper border-yellow-500/30">
                            <img src="galon familiar de 4 litros.png" alt="Chicha ASWA 4L" onerror="this.style.display='none'">
                            <div class="img-placeholder">
                                <span class="text-xs">ASWA</span>
                                <span class="text-xl">4L</span>
                            </div>
                        </div>
                        <div>
                            <p class="font-bold text-sm">Presentaci√≥n 4L</p>
                            <p class="text-yellow-400 font-black text-xl">S/ 15.00</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 bg-black p-2 rounded-2xl border border-zinc-800">
                        <button type="button" onclick="updateQty('p4l', -1)" class="w-8 h-8 font-black text-zinc-600">-</button>
                        <span id="qty-p4l" class="font-bold text-lg w-4 text-center">0</span>
                        <button type="button" onclick="updateQty('p4l', 1)" class="w-8 h-8 bg-yellow-500 text-black rounded-xl font-black shadow-lg shadow-yellow-500/20">+</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ENV√çO -->
        <section class="space-y-4">
            <h2 class="font-bold text-lg flex items-center gap-2 mb-4">
                <span class="w-1.5 h-6 bg-yellow-500 rounded-full"></span>
                Datos de Entrega
            </h2>
            
            <input type="text" id="nombre" placeholder="Nombre completo" required class="w-full p-4 rounded-2xl input-dark text-sm">
            
            <div class="grid grid-cols-2 gap-3">
                <input type="tel" id="telefono" placeholder="Celular" required class="w-full p-4 rounded-2xl input-dark text-sm">
                <select id="distrito" onchange="calculateTotal()" class="w-full p-4 rounded-2xl input-dark bg-[#121214] text-sm appearance-none">
                    <option value="0" disabled selected>Distrito...</option>
                    <option value="3">Morales (S/3)</option>
                    <option value="4">Tarapoto (S/4)</option>
                    <option value="5">Banda de Shilcayo (S/5)</option>
                    <option value="0">Recojo en Local (S/0)</option>
                </select>
            </div>
            
            <textarea id="direccion" rows="3" placeholder="Direcci√≥n exacta (Calle, N¬∞ Casa, Referencia)" required class="w-full p-4 rounded-2xl input-dark text-sm"></textarea>
        </section>

        <!-- M√âTODO DE PAGO -->
        <section class="space-y-4">
            <h2 class="font-bold text-lg flex items-center gap-2 mb-4">
                <span class="w-1.5 h-6 bg-yellow-500 rounded-full"></span>
                M√©todo de Pago
            </h2>
            <div class="grid grid-cols-3 gap-2">
                <button type="button" onclick="setPayment('Efectivo')" id="btn-efectivo" class="payment-option p-4 rounded-2xl bg-zinc-900 flex flex-col items-center gap-2 active">
                    <i data-lucide="banknote" class="w-6 h-6 text-green-500"></i>
                    <span class="text-[10px] font-bold">Efectivo</span>
                </button>
                <button type="button" onclick="setPayment('Yape')" id="btn-yape" class="payment-option p-4 rounded-2xl bg-zinc-900 flex flex-col items-center gap-2">
                    <div class="w-6 h-6 bg-purple-600 rounded-md flex items-center justify-center text-[10px] font-bold">Y</div>
                    <span class="text-[10px] font-bold">Yape</span>
                </button>
                <button type="button" onclick="setPayment('Plin')" id="btn-plin" class="payment-option p-4 rounded-2xl bg-zinc-900 flex flex-col items-center gap-2">
                    <div class="w-6 h-6 bg-cyan-500 rounded-md flex items-center justify-center text-[10px] font-bold">P</div>
                    <span class="text-[10px] font-bold">Plin</span>
                </button>
            </div>
        </section>
    </form>

    <!-- FOOTER DE TOTAL -->
    <div class="fixed bottom-0 left-0 w-full bg-black/90 backdrop-blur-2xl border-t border-zinc-900 p-6 z-[60]">
        <div class="max-w-md mx-auto flex items-center justify-between gap-6">
            <div class="flex flex-col">
                <p class="text-[9px] text-zinc-500 font-black uppercase tracking-widest mb-1">Importe Total</p>
                <p class="text-4xl font-bebas text-yellow-500" id="total-price">S/ 0.00</p>
            </div>
            <button onclick="document.getElementById('orderForm').dispatchEvent(new Event('submit'))" class="btn-order flex-1 h-16 rounded-[1.5rem] font-black text-lg flex items-center justify-center">
                CONTINUAR <i data-lucide="arrow-right" class="ml-2 w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- MODAL DE RECIBO Y PAGO DIGITAL -->
    <div id="paymentModal" class="modal">
        <div class="bg-zinc-900 w-full max-w-sm rounded-[2.5rem] p-8 border border-zinc-800 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="text-center mb-6">
                <h3 class="font-bebas text-3xl text-yellow-500 tracking-widest">RESUMEN DE PAGO</h3>
                <p id="payment-instruction" class="text-xs text-zinc-400 mt-2">Realiza la transferencia para confirmar</p>
            </div>

            <!-- DETALLE DE RECIBO -->
            <div class="bg-black/50 rounded-2xl p-4 mb-6 space-y-2 border border-zinc-800/50">
                <div id="receipt-items" class="text-xs space-y-1 border-b border-zinc-800 pb-2"></div>
                <div class="flex justify-between font-bold text-yellow-500 pt-1">
                    <span>TOTAL A PAGAR:</span>
                    <span id="receipt-total">S/ 0.00</span>
                </div>
            </div>

            <!-- DATOS DE TRANSFERENCIA (CON EL QR SUBIDO) -->
            <div id="digital-payment-info" class="hidden text-center space-y-4">
                <div class="bg-white p-2 rounded-2xl inline-block mx-auto">
                    <!-- L√≠nea 225: Aqu√≠ se agrega la imagen real del QR -->
                    <img src="yape del negocio.jpg" alt="QR Yape ASWA" class="qr-image">
                </div>
                
                <div>
                    <p class="text-[10px] text-zinc-500 uppercase font-black">N√∫mero de destino</p>
                    <p class="text-xl font-black text-white tracking-widest">986 445 531</p>
                    <p class="text-[10px] text-zinc-500">Titular: ASWA - La Rica Chicha</p>
                </div>
            </div>

            <div id="cash-info" class="text-center py-4">
                <p class="text-sm text-zinc-400 italic">"Ten el monto exacto listo para agilizar la entrega."</p>
            </div>

            <button onclick="confirmarYEnviar()" class="w-full btn-order h-14 rounded-2xl font-black mt-6">
                CONFIRMAR Y ENVIAR <i data-lucide="check" class="ml-2 w-5 h-5"></i>
            </button>
            <button onclick="closePaymentModal()" class="w-full text-zinc-500 text-xs mt-4 font-bold uppercase tracking-widest">
                Regresar
            </button>
        </div>
    </div>

        </section>

    
        <div class="flex flex-col items-center gap-4 pb-12 opacity-50">
            <p class="text-[9px] uppercase font-black tracking-[0.6em] text-yellow-500/80 text-center">Sabor que une a la familia
            </p>

            
            <!-- BOT√ìN DE GOOGLE MAPS -->
            <a href="https://www.google.com/maps/search/?api=1&query=ASWA+Tarapoto" target="_blank" 
               class="location-link flex items-center gap-3 px-6 py-3 rounded-2xl bg-zinc-900/50">
                <i data-lucide="map-pin" class="text-yellow-500 w-5 h-5"></i>
                <div class="text-left">
                    <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-wider leading-none">Vis√≠tanos en nuestro local</p>
                    <p class="text-sm font-bold text-white">Ver en Google Maps</p>
                </div>
            </a>
        </div>
    </form>

    <!-- FOOTER -->
    <div class="fixed bottom-0 left-0 w-full bg-black/90 backdrop-blur-2xl border-t border-zinc-900 p-6 z-[60]">
        <div class="max-w-md mx-auto flex items-center justify-between gap-6">
            <div class="flex flex-col">
                <p class="text-[9px] text-zinc-500 font-black uppercase tracking-widest mb-1">Importe Total</p>
                <p class="text-4xl font-bebas text-yellow-500" id="total-price">S/ 0.00</p>
            </div>
            <button onclick="document.getElementById('orderForm').dispatchEvent(new Event('submit'))" class="btn-order flex-1 h-16 rounded-[1.5rem] font-black text-lg flex items-center justify-center">
                ENVIAR PEDIDO <i data-lucide="arrow-right" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <script type="module">
        lucide.createIcons();
        const prices = { p2l: 9, p3l: 13, p4l: 15 };
        const cart = { p2l: 0, p3l: 0, p4l: 0 };
        let logoClicks = 0;

        window.updateQty = (p, c) => {
            const n = cart[p] + c;
            if (n >= 0) {
                cart[p] = n;
                document.getElementById(`qty-${p}`).textContent = n;
                calculateTotal();
            }
        };

        window.calculateTotal = () => {
            let s = (cart.p2l * prices.p2l) + (cart.p3l * prices.p3l) + (cart.p4l * prices.p4l);
            let d = parseFloat(document.getElementById('distrito').value) || 0;
            let t = s > 0 ? s + d : 0;
            document.getElementById('total-price').textContent = `S/ ${t.toFixed(2)}`;
            return { s, d, t };
        };

        window.toggleVuelto = (s) => {
            document.getElementById('vuelto-container').classList.toggle('hidden', !s);
            if(s) document.getElementById('vuelto-monto').focus();
        };

        window.generarPedido = async (e) => {
            e.preventDefault();
            const { s, d, t } = calculateTotal();
            
            if (s === 0) return alert("Debes agregar al menos un producto.");
            if (document.getElementById('distrito').selectedIndex === 0) return alert("Por favor selecciona una zona de env√≠o.");

            const nombre = document.getElementById('nombre').value;
            const telefono = document.getElementById('telefono').value;
            const direccion = document.getElementById('direccion').value;
            const pago = document.querySelector('input[name="pago"]:checked').value;
            const vuelto = document.getElementById('vuelto-monto').value;

            document.getElementById('successMsg').style.display = 'flex';

            const pedidoData = {
                nombre, telefono, direccion,
                distrito: document.getElementById('distrito').options[document.getElementById('distrito').selectedIndex].text,
                items: { ...cart },
                total: t,
                pago,
                vuelto: pago === 'Efectivo' ? vuelto : 'N/A'
            };

            // Firebase Storage
            try {
                if (window.isAuth) {
                    const colRef = collection(window.db, window.appId, 'public', 'data', 'pedidos');
                    await addDoc(colRef, { ...pedidoData, fecha: serverTimestamp() });
                }
            } catch (err) { console.error("Error DB:", err); }

            let itemsStr = "";
            if (cart.p2l > 0) itemsStr += `‚Ä¢ 2 Litros: ${cart.p2l}\n`;
            if (cart.p3l > 0) itemsStr += `‚Ä¢ 3 Litros: ${cart.p3l}\n`;
            if (cart.p4l > 0) itemsStr += `‚Ä¢ 4 Litros: ${cart.p4l}\n`;

            const msg = `üåΩ *NUEVO PEDIDO ASWA*\n\nüë§ *Cliente:* ${nombre}\nüì± *Tel:* ${telefono}\nüìç *Zona:* ${pedidoData.distrito}\nüè† *Dir:* ${direccion}\n\nüõí *Detalle:*\n${itemsStr}\n[...]`;
            
            setTimeout(() => {
                window.location.href = `https://wa.me/51986445531?text=${encodeURIComponent(msg)}`;
            }, 2000);
        };

        window.checkAdmin = () => {
            logoClicks++;
            if(logoClicks >= 5) {
                document.getElementById('adminPanel').classList.remove('hidden');
                cargarPedidosAdmin();
                logoClicks = 0;
            }
            setTimeout(() => logoClicks = 0, 4000);
        };

        function cargarPedidosAdmin() {
            if (!window.isAuth) return;
            const q = query(collection(window.db, window.appId, 'public', 'data', 'pedidos'), orderBy('fecha', 'desc'));
            onSnapshot(q, (snapshot) => {
                const html = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const f = d.fecha ? d.fecha.toDate().toLocaleString('es-PE', { hour12: true }) : 'En proceso...';
                    return `<div class="bg-zinc-900/50 p-5 rounded-3xl border border-zinc-800">\n                        <div class="flex justify-between items-start mb-2">\n                            <span class="font-bold text-yellow-500">${d.nombre}</span>\n                            <span class="bg-yellow-500 text-black px-2 py-0.5 rounded text-[10px] font-black">S/ ${d.total.toFixed(2)}</span>\n                        </div>\n                        <p class="text-[10px] text-zinc-500 mb-3">${f} ‚Ä¢ ${d.pago}</p>\n                        <div class="text-[11px] text-zinc-300 bg-black/40 p-3 rounded-xl border border-zinc-800/50">\n                            <strong>Dir:</strong> ${d.direccion}<br>\n                            <strong>Zona:</strong> ${d.distrito}\n                        </div>\n                    </div>`;
                }).join('');
                document.getElementById('listaPedidos').innerHTML = html || '<div class="text-center py-20 text-zinc-700 font-bold uppercase tracking-widest">Sin registros</div>';
            }, (error) => console.error(error));
        }

        window.cerrarAdmin = () => { document.getElementById('adminPanel').classList.add('hidden'); };
    </script>
</body>
</html>
